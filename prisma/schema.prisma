generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             String    @id @default(uuid())
  fullName       String
  email          String    @unique
  password       String?
  googleId       String?   @unique
  facebookId     String?   @unique
  avatar         String?
  otp            String?
  otpExpiresAt   DateTime?
  verified       Boolean   @default(false)
  role           Role      @default(USER)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  bookings       Booking[]
  sentMessages   Message[] @relation("SentMessages")
  recvMessages   Message[] @relation("ReceivedMessages")
}

model Space {
  id          String    @id @default(uuid())
  title       String
  description String
  price       Float
  capacity    Int?
  images      String[]  @default([])
  amenities   String[]  @default([])
  createdAt   DateTime  @default(now())
  bookings    Booking[]
}

model Booking {
  id         String        @id @default(uuid())
  userId     String
  spaceId    String
  startTime  DateTime
  endTime    DateTime
  status     BookingStatus @default(PENDING)
  paymentId  String?
  amount     Float
  createdAt  DateTime      @default(now())
  user       User          @relation(fields: [userId], references: [id])
  space      Space         @relation(fields: [spaceId], references: [id])

  Payment Payment[]
}

model Payment {
  id            String   @id @default(uuid())
  stripePaymentId String @unique
  bookingId     String?
  amount        Float
  currency      String   @default("usd")
  status        String
  createdAt     DateTime @default(now())
  booking       Booking? @relation(fields: [bookingId], references: [id])
}

model Message {
  id         String   @id @default(uuid())
  senderId   String
  receiverId String
  content    String
  createdAt  DateTime @default(now())
  sender     User     @relation("SentMessages", fields: [senderId], references: [id])
  receiver   User     @relation("ReceivedMessages", fields: [receiverId], references: [id])
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

enum BookingStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
}
