name: "setup-ssh"
description: "Setup SSH for deployment"
inputs:
  VPS_USER:
    description: "VPS username"
    required: true
  VPS_HOST:
    description: "VPS hostname"
    required: true
  VPS_SSH_PRIVATE_KEY:
    description: "SSH private key"
    required: true
runs:
  using: "composite"
  steps:
    - name: Setup SSH
      shell: bash
      run: |
        mkdir -p ~/.ssh && chmod 700 ~/.ssh
        echo "${{ inputs.VPS_SSH_PRIVATE_KEY }}" | tr -d '\r' > ~/.ssh/deploy_key
        chmod 600 ~/.ssh/deploy_key
        ssh-keyscan -H ${{ inputs.VPS_HOST }} >> ~/.ssh/known_hosts
        chmod 644 ~/.ssh/known_hosts
        
        cat > ~/.ssh/config <<SSHEOF
        Host deploy-server
          HostName ${{ inputs.VPS_HOST }}
          User ${{ inputs.VPS_USER }}
          IdentityFile ~/.ssh/deploy_key
          StrictHostKeyChecking no
        SSHEOF
        chmod 600 ~/.ssh/config
        echo "âœ… SSH configured"
        
    - name: Test SSH Connection
      shell: bash
      run: |
        ssh deploy-server "echo 'ðŸŽ‰ SSH Connected successfully!'"
